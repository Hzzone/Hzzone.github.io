<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> </title>
    <link rel="shortcut icon" href="https://tuchuang-1252747889.cos.ap-guangzhou.myqcloud.com/hzzoneio_favicon.ico" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../static/css/github-markdown.css" type="text/css">
    <link rel="stylesheet" href="../static/css/site.css" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/xcode.min.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      jax: ["input/TeX", "output/CommonHTML"]
    },
    CommonHTML: { linebreaks: { automatic: true } },
    "HTML-CSS": { linebreaks: { automatic: true } },
    SVG: { linebreaks: { automatic: true } }
  });
</script>
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>
</head>
<body for="html-export">
    <div class="mume markdown-preview markdown-body">
        <div class="homepage">
            <a href="/">主页</a>
        </div>
            <pre><code class="python">from torchvision import datasets, models, transforms

alexnet_model = models.alexnet(pretrained=True)
alexnet_model.eval()

transform = transforms.Compose([
    transforms.ToPILImage(),
    transforms.CenterCrop(224),
    transforms.ToTensor(),
    transforms.Normalize(mean=[0.485, 0.456, 0.406],
                                 std=[0.229, 0.224, 0.225])
])

img = io.imread(&quot;cat.jpg&quot;)
img = transform(img)
img = img.unsqueeze(0)

prob = F.softmax(alexnet_model(image), dim=1)
pred = torch.argmax(prob, dim=1)</code></pre>
<p>以上代码使用pytorch预训练的alexnet进行预测一张猫的图片，如果不加上<code>alexnet_model.eval()</code>则会导致每次运行预测的结果都不一样。
具体原因在<a href="https://discuss.pytorch.org/t/pretrained-resnet-constant-output/2760">Pretrained resnet constant output</a>有解释：</p>
<p>因为<code>BatchNorm</code>和<code>Dropout</code>是随机的，会导致每次运行都不一致，所以在传递输入之前，需要切换至<code>model.eval()</code>进行预测。或者使用<code>model.train()</code>来进行训练。</p>

        <script data-isso="https://hzzone.io/isso"
        src="https://hzzone.io/isso/js/embed.min.js"></script>

<section id="isso-thread"></section>
    </div>
</body>
</html>