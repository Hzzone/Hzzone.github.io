<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <title>GitHub 支持 LaTex 的几种方案以及 LaTeX 生成 svg</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="shortcut icon" href="https://tuchuang-1252747889.cos.ap-guangzhou.myqcloud.com/hzzoneio_favicon.ico" />
        <!--<link rel="stylesheet" type="text/css" href="css/aircloud.css">-->
        <link rel="stylesheet" type="text/css" href="/static/css/aircloud.css">
        <link rel="stylesheet" type="text/css" href="/static/css/next.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css" />
        <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/styles/default.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/highlight.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/xcode.min.css">
        <script type="text/javascript" defer src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <script async src="https:////busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <link rel="stylesheet" href="/static/css/iconfont.css">
        <script src="/static/js/iconfont.js"></script>
    </head>

    <body>
        <div id="progress-bar"></div>
        <div class="site-nav-toggle" id="site-nav-toggle">
            <button>
                <span class="btn-bar"></span>
                <span class="btn-bar"></span>
                <span class="btn-bar"></span>
            </button>
        </div>
        <div class="index-about">
            <i>To be talented & positive.</i>
        </div>
        <div class="index-container">
            <div class="index-left">
                <div class="nav" id="nav">
                    <div class="avatar-name">
                        <div class="avatar">
                            <img src="https://avatars2.githubusercontent.com/u/19267349"></div>
                        <div class="name">
                            <i>Zhizhong Huang</i>
                        </div>
                    </div>
                    <div class="contents" id="nav-content">
                        <ul>
                            <li style="padding-left: 10px;">
                                <a href="/">
                                    <!--<i class="fa fa-fw fa-home"></i>-->
                                    <!--<span class="iconfont icon-zhihu"></span>-->
                                    <!--<i class="iconfont icon-home"></i>-->
                                    <span>主页</span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/Hzzone">
                                    <i class="iconfont icon-github"></i>
                                </a>
                                <a href="https://www.zhihu.com/people/hzzone">
                                    <i class="iconfont icon-zhihu"></i>
                                </a>
                            </li>
                            <!--<li>-->
                                <!--<a href="https://github.com/Hzzone">-->
                                    <!--&lt;!&ndash;<i class="fab fa-github"></i>&ndash;&gt;-->
                                    <!--<i class="iconfont icon-github"></i>-->
                                    <!--<span>Github</span></a>-->
                            <!--</li>-->
                            <!--<li>-->
                                <!--<a href="https://www.zhihu.com/people/hzzone">-->
                                    <!--&lt;!&ndash;<i class="fa fa-fw fa-zhihu"></i>&ndash;&gt;-->
                                    <!--<i class="iconfont icon-zhihu"></i>-->
                                    <!--<span>知乎</span>-->
                                <!--</a>-->
                            <!--</li>-->
                        </ul>
                    </div>
                    <!--<div id="toc" class="toc-article toc-fixed" style="height: 823px; overflow-y: scroll;">-->
                        <!--<ol class="toc">-->
                            <!--<li class="toc-item toc-level-3 active">-->
                                <!--<a class="toc-link" href="#目前遇到的问题">-->
                                    <!--<span class="toc-text">目前遇到的问题</span></a>-->
                            <!--</li>-->
                            <!--<li class="toc-item toc-level-3">-->
                                <!--<a class="toc-link" href="#问题归纳与解决">-->
                                    <!--<span class="toc-text">问题归纳与解决</span></a>-->
                            <!--</li>-->
                            <!--<li class="toc-item toc-level-3">-->
                                <!--<a class="toc-link" href="#更多">-->
                                    <!--<span class="toc-text">更多</span></a>-->
                            <!--</li>-->
                        <!--</ol>-->
                    <!--</div>-->
                </div>
                <div class="index-about-mobile">
                    <i></i>
                </div>
            </div>
            <div class="content-wrap">
                <!-- Main Content -->
                <div class="post-container">
  <div class="post-title">GitHub 支持 LaTex 的几种方案以及 LaTeX 生成 svg</div>
  <div class="post-meta">
    <span class="attr">发布于：
      <span>2018-10-19 16:48:33</span>
    </span>
    <span class="attr">标签：
      <span>其他</span>
      </span>
    <span class="attr">访问：
      <span id="busuanzi_value_page_pv">1368</span></span>
  </div>
    <div class="markdown-body post-content post_href">
        
        <h3>GitHub 支持 LaTex 的几种方案</h3>
<ol>
<li><a href="http://www.codecogs.com/latex/eqneditor.php">codecogs</a> 生成外部链接</li>
</ol>
<p>优点：方便快捷，可以生成 gif、svg、png 等格式的图片，支持下载和直接外部链接引用。</p>
<p>缺点：收费，具体见 <a href="https://www.oschina.net/question/589241_133621">名为开源，实际上每年都要收钱，这种策略好吗？</a>，<a href="https://blog.csdn.net/hdg34jk/article/details/78858067">CODECOGS在线LaTeX公式编辑器收费陷阱！</a>。服务不可靠，如果提供服务的公司突然倒闭，那么以前写的博客都没用了。而且只能联网访问。</p>
<p>类似的还有 Google Chart，但是会面临被墙的风险。</p>
<ol start="2">
<li><a href="https://www.mathjax.org/">MathJax</a></li>
</ol>
<p>GitHub 因为安全问题不支持引入 js、css 文件，也不支持 <code>&lt;script&gt;、&lt;style&gt;</code> 等标签，所以不可行。</p>
<ol start="3">
<li><a href="https://github.com/apps/texify">GitHub App Texify</a></li>
</ol>
<p>优点: 不需要太多配置，直接像 LaTeX 一样使用，直接保存图片，可以本地预览。</p>
<p>缺点: 生成 <code>*.tex.md</code> 并保存 svg。图片文件，然后直接提交到整个仓库，非常愚蠢的一种做法，而且并不支持 GitHub Issue。</p>
<ol start="4">
<li><a href="https://chrome.google.com/webstore/detail/github-with-mathjax/ioemnmodlmafdkllaclgeombjnmnbima?utm_source=chrome-app-launcher-info-dialog">GitHub with MathJax</a></li>
</ol>
<p>通过本地渲染 GitHub 界面支持 LaTeX，自欺欺人的一种方法，不推荐…</p>
<ol start="5">
<li>本地生成图片并上传到图床或者 GitHub</li>
</ol>
<p>不是太方便，但是可以解决很多已知问题。</p>
<h2 id="LaTeX-生成-svg">LaTeX 生成 svg</h2>
<p>参考该回答: <a href="https://stackoverflow.com/questions/9588261/converting-a-latex-code-to-mathml-or-svg-code-in-python#answer-16893390">converting a latex code to mathml or svg code in python</a>。</p>
<p>通过 <code>latex</code> 命令生成 DVI 文件，然后使用 <a href="https://dvisvgm.de/">dvisvgm</a> 生成 svg 图片。</p>
<p>通过模板转换:</p>
<pre class="hljs"><code><span class="hljs-tag">\<span class="hljs-name">documentclass</span><span class="hljs-string">[paper=a5,fontsize=12pt]</span><span class="hljs-string">{scrbook}</span></span>
<span class="hljs-tag">\<span class="hljs-name">usepackage</span><span class="hljs-string">[pdftex,active,tightpage]</span><span class="hljs-string">{preview}</span></span>
<span class="hljs-tag">\<span class="hljs-name">usepackage</span><span class="hljs-string">{amsmath}</span></span>
<span class="hljs-tag">\<span class="hljs-name">usepackage</span><span class="hljs-string">{amssymb}</span></span>
<span class="hljs-tag">\<span class="hljs-name">usepackage</span><span class="hljs-string">{amsfonts}</span></span>
<span class="hljs-tag">\<span class="hljs-name">usepackage</span><span class="hljs-string">{tikz}</span></span>
<span class="hljs-tag">\<span class="hljs-name">begin</span><span class="hljs-string">{document}</span></span>
<span class="hljs-tag">\<span class="hljs-name">begin</span><span class="hljs-string">{preview}</span></span>
<span class="hljs-tag">\<span class="hljs-name">begin</span><span class="hljs-string">{tikzpicture}</span><span class="hljs-string">[inner sep=0pt, outer sep=0pt]</span></span>
<span class="hljs-tag">\<span class="hljs-name">node</span></span> at (0, 0) {texCode}; <span class="hljs-comment">% &lt;--Put your tex-code here</span>
<span class="hljs-tag">\<span class="hljs-name">end</span><span class="hljs-string">{tikzpicture}</span></span>
<span class="hljs-tag">\<span class="hljs-name">end</span><span class="hljs-string">{preview}</span></span>
<span class="hljs-tag">\<span class="hljs-name">end</span><span class="hljs-string">{document}</span></span>
</code></pre>
<p>缺点是会产生很多中间文件，需要安装 <code>LaTex</code> 环境，大到 3~4 G。</p>
<h3>如何选择</h3>
<p>目前我认为最好的方法是通过 <a href="http://www.codecogs.com/latex/eqneditor.php">codecogs</a> 下载 gif 图片，然后上传到图床或者本地的仓库，可以解决服务不稳定的问题，至少可以保证自己的服务器或域名是可以访问的。</p>
<p>另外一种方法，自己搭建一个服务器，随便采用什么框架，然后通过上面介绍的 <a href="#LaTeX-生成-svg">LaTeX 生成 svg</a> 提供一个类似于 codecogs 的服务，返回 svg 图片。而且目前也有类似功能的，例如 <a href="https://github.com/DMOJ/texoid">texoid</a>。</p>
<p>实现起来很简单，但我嫌麻烦，可以考虑上一种方法，我认为是在 GitHub 不支持 LaTeX 时的最优解。</p>
<h3>LaTex Fomula to SVG</h3>
<p>将 LaTex 公式转 SVG 图片，有几种方法，转其他格式的图片可以使用其他的 API:</p>
<ul>
<li>codecogs API</li>
</ul>
<p>访问有限制，需要额外的错误控制。请求、生成一张图片总共花费大概 ~2s，效果如下。</p>
<ul>
<li>tex2svg</li>
</ul>
<p>来源于 <a href="https://askubuntu.com/questions/33196/how-to-convert-latex-equations-to-svg">How to convert LaTeX equations to SVG?</a>。</p>
<p>安装命令行工具:</p>
<pre class="hljs"><code>npm install --global https://github.com/mathjax/mathjax-node-cli.git
</code></pre>
<p>转换一个公式:</p>
<pre class="hljs"><code>tex2svg '\sin^2{\theta} + \cos^2{\theta} = 1' &gt; mathjax.svg
</code></pre>
<p>花费 ~2s，比 codecogs 略长。</p>
<ul>
<li>latex 和 dvisvgm</li>
</ul>
<p>首先 ubuntu 需要安装 LaTex:</p>
<pre class="hljs"><code>sudo apt-get install texlive-full
</code></pre>
<pre class="hljs"><code><span class="hljs-tag">\<span class="hljs-name">documentclass</span><span class="hljs-string">[paper=a5,fontsize=15px]</span><span class="hljs-string">{scrbook}</span></span>
<span class="hljs-tag">\<span class="hljs-name">usepackage</span><span class="hljs-string">[pdftex,active,tightpage]</span><span class="hljs-string">{preview}</span></span>
<span class="hljs-tag">\<span class="hljs-name">usepackage</span><span class="hljs-string">{amsmath}</span></span>
<span class="hljs-tag">\<span class="hljs-name">usepackage</span><span class="hljs-string">{amssymb}</span></span>
<span class="hljs-tag">\<span class="hljs-name">usepackage</span><span class="hljs-string">{amsfonts}</span></span>
<span class="hljs-tag">\<span class="hljs-name">usepackage</span><span class="hljs-string">{tikz}</span></span>
<span class="hljs-tag">\<span class="hljs-name">begin</span><span class="hljs-string">{document}</span></span>
<span class="hljs-tag">\<span class="hljs-name">begin</span><span class="hljs-string">{preview}</span></span>
<span class="hljs-tag">\<span class="hljs-name">begin</span><span class="hljs-string">{tikzpicture}</span><span class="hljs-string">[inner sep=0pt, outer sep=0pt]</span></span>
<span class="hljs-tag">\<span class="hljs-name">node</span></span> at (0, 0) {<span class="hljs-tag">\<span class="hljs-name">begin</span><span class="hljs-string">{math}</span></span><span class="hljs-tag">\<span class="hljs-name">sin</span></span>^2{<span class="hljs-tag">\<span class="hljs-name">theta</span></span>} + <span class="hljs-tag">\<span class="hljs-name">cos</span></span>^2{<span class="hljs-tag">\<span class="hljs-name">theta</span></span>} = 1<span class="hljs-tag">\<span class="hljs-name">end</span><span class="hljs-string">{math}</span></span>}; <span class="hljs-comment">% &lt;--Put your tex-code here</span>
<span class="hljs-tag">\<span class="hljs-name">end</span><span class="hljs-string">{tikzpicture}</span></span>
<span class="hljs-tag">\<span class="hljs-name">end</span><span class="hljs-string">{preview}</span></span>
<span class="hljs-tag">\<span class="hljs-name">end</span><span class="hljs-string">{document}</span></span>
</code></pre>
<pre class="hljs"><code>➜  tmp time latex test.tex
...
latex test.tex  0.20s user 0.03s system 87% cpu 0.264 total
</code></pre>
<pre class="hljs"><code>time dvisvgm --no-fonts test.dvi test.svg
...
dvisvgm --no-fonts test.dvi test.svg  0.19s user 0.01s system 93% cpu 0.211 total
</code></pre>
<p>这种方法最长也就 ~0.2s，比上面两种短的多得多。</p>
<ul>
<li>pdflatex 和 inkscape</li>
</ul>
<p>未测试，和上一种方法时间上差不多，但是看生成的 pdf 比较好看，没有导出 svg。</p>
<ul>
<li>svg to png</li>
</ul>
<p><a href="https://cairosvg.org/">CairoSVG</a> 将 svg 转 png</p>
<p>ubuntu:</p>
<pre class="hljs"><code>sudo apt-<span class="hljs-built_in">get</span> install libcairo2-<span class="hljs-built_in">dev</span>
sudo apt-<span class="hljs-built_in">get</span> install libffi-<span class="hljs-built_in">dev</span>
pip3 install cairosvg
</code></pre>
<p><strong>综上，其实最后两种方法速度最快且效果很好</strong></p>
<pre class="hljs"><code>ssh://ubuntu@hzzone.io:22/home/ubuntu/miniconda3/bin/python3 -u /home/ubuntu/online-latex-mathmatical-fomula/benchmark.py
<span class="hljs-meta">  1%</span><span class="bash">|▎                                    | 695/68883 [02:45&lt;4:30:15,  4.21it/s]</span>
</code></pre>
<h3>实现</h3>
<p>我最后还是实现了一个类似于 codecogs 的网站，因为不擅长前端，做的比较粗糙，具体原理和功能见 <a href="https://github.com/Hzzone/online-latex-mathmatical-fomula">online-latex-mathmatical-fomula</a></p>
<p>在线 <a href="https://hzzone.io/api/latex">demo</a></p>
<p><img src="https://raw.githubusercontent.com/Hzzone/online-latex-mathmatical-fomula/master/demo.gif" alt=""></p>


  </div>
    <script>
        var posts = document.getElementsByClassName('post_href')[0].getElementsByTagName('a');
        for (var i=0; i<posts.length; i++)
            posts[i].setAttribute('target', '_blank');
    </script>
</div>

                <script data-isso="https://hzzone.io/isso" data-isso-vote="false"
                        src="https://hzzone.io/isso/js/embed.min.js"></script>

                <div class="comments">
                    <section id="isso-thread"></section>
                </div>
            </div>

        </div>
        <script type="text/javascript">const navToggle = document.getElementById('site-nav-toggle');
            navToggle.addEventListener('click',
            function() {
                let aboutContent = document.getElementById('nav-content');
                if (!aboutContent.classList.contains('show-block')) {
                    aboutContent.classList.add('show-block');
                    aboutContent.classList.remove('hide-block');
                } else {
                    aboutContent.classList.add('hide-block');
                    aboutContent.classList.remove('show-block');
                }
            });</script>
    <script type="text/javascript">
  window.MathJax = {
    jax: ["input/TeX","input/MathML","input/AsciiMath","output/CommonHTML"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    },
    CommonHTML: { linebreaks: { automatic: true } },
    "HTML-CSS": { linebreaks: { automatic: true } },
         SVG: { linebreaks: { automatic: true } }
  };
</script>
    <script>
        var domDiv = document.getElementById('progress-bar');
        //domH:可视区域的高度
        var domH = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
        window.addEventListener('scroll',function(){
            var pageHeight = Math.max(
             document.body.scrollHeight,
             document.documentElement.scrollHeight,
             document.body.offsetHeight,
             document.documentElement.offsetHeight,
             document.documentElement.clientHeight
            );
            domDiv.style.width = Math.round(pageYOffset/(pageHeight-domH)*100)+'%';
        },false);

    </script>
    </body>

</html>